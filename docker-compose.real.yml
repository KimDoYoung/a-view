version: "3.9"

services:
  redis:
    image: redis:7-alpine
    command: ["redis-server", "--appendonly", "yes"]
    volumes: [ "redis-data-real:/data" ]
    ports: [ "6379:6379" ]
    restart: unless-stopped

  aview:
    build:
      context: .
      dockerfile: Dockerfile.real
    image: aview:latest        # ğŸ”¹ ì´ë¯¸ì§€ ì´ë¦„ (ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ì§€ì • ê°€ëŠ¥)
    container_name: aview_app  # ğŸ”¹ ì»¨í…Œì´ë„ˆ ì´ë¦„      
    depends_on: [ redis ]
    env_file: [ ./.env.real ]     # ì•± í™˜ê²½ë³€ìˆ˜ (.env.realì—ì„œ PROTOCOL/SSL_* ì½ìŒ)
    environment:
      AVIEW_MODE: "real"
      REDIS_HOST: "redis"
      TZ: "Asia/Seoul"
      BASE_DIR: "/aview/data"     # ìš´ì˜ë„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œë¥¼ í†µì¼ ê¶Œì¥
    ports: [ "8003:8003" ]
    # ìš´ì˜ í˜¸ìŠ¤íŠ¸ì˜ ì˜êµ¬ ë°ì´í„° ê²½ë¡œ â†” ì»¨í…Œì´ë„ˆ /aview/data
    volumes:
      - /var/opt/aview/data:/aview/data
      # (HTTPS í•„ìš” ì‹œ) ì¸ì¦ì„œ ë””ë ‰í† ë¦¬ ì½ê¸°ì „ìš© ë§ˆìš´íŠ¸
      # - /etc/letsencrypt:/etc/letsencrypt:ro
    restart: unless-stopped
    user: "${AVIEW_UID:-1001}:${AVIEW_GID:-1001}"

volumes:
  redis-data-real:
