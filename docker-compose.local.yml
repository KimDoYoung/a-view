version: "3.9"

services:
  redis:
    image: redis:7-alpine
    command: ["redis-server", "--appendonly", "yes"]
    volumes: [ "redis-data-local:/data" ]
    ports: [ "6379:6379" ]
    restart: unless-stopped

  aview:
    build:
      context: .
      dockerfile: Dockerfile.local
    image: aview:latest        # ğŸ”¹ ì´ë¯¸ì§€ ì´ë¦„ (ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ì§€ì • ê°€ëŠ¥)
    container_name: aview_app  # ğŸ”¹ ì»¨í…Œì´ë„ˆ ì´ë¦„      
    depends_on: [ redis ]
    env_file: [ ./.env.local ]   # ì•± í™˜ê²½ë³€ìˆ˜ ë¡œë”© (.env.localì€ 'ì•±' ì„¤ì •)
    environment:
      AVIEW_MODE: "local"         # í™•ì‹¤íˆ local ê°•ì œ
      REDIS_HOST: "redis"         # ì»¨í…Œì´ë„ˆ DNS
      TZ: "Asia/Seoul"
      BASE_DIR: "/aview/data"     # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œë¡œ override (ë¡œì»¬ .env ìˆ˜ì • ì—†ì´ ì‚¬ìš©)
    ports: [ "8003:8003" ]
    # Windows í˜¸ìŠ¤íŠ¸ ê²½ë¡œ â†” ì»¨í…Œì´ë„ˆ ê²½ë¡œ ë§¤í•‘
    # ì˜ˆì‹œ: C:\temp\aview ë¥¼ ì»¨í…Œì´ë„ˆ /aview/data ë¡œ
    volumes:
      - "C:/tmp/aview:/aview/data"
    restart: unless-stopped
    user: "${AVIEW_UID:-1000}:${AVIEW_GID:-1000}"

volumes:
  redis-data-local:
